import{i as N,l as V,m as X,p as Z,q as ee,s as te,v as se,j as R,x as b,k as e,y as ae,z as re,A as le,R as $,B as oe,C as ie,D as ue,E as ce,G as ne,H as T,I,J as de,K as he,L as me,M as ve,N as ye,O as pe,P as Ee,Q as ge,S as M,T as Ae,U as k}from"./app-GLVeLgbA.js";const we=["/","/note/README(project-homepage).html","/note/","/resource/","/share/","/website/","/note/English/disable.html","/note/English/","/note/software-test/","/note/sundry/disable.html","/note/sundry/encrypt.html","/note/sundry/layout.html","/note/sundry/markdown.html","/note/sundry/page.html","/note/sundry/","/resource/tool/","/resource/tool/Snipaste.html","/resource/tool/Watt%20toolkit.html","/share/life/accumulate.html","/share/life/","/share/study/English-speaking.html","/share/study/","/share/study/test.html","/resource/tutorial/Favicon-ico.html","/resource/tutorial/","/resource/tutorial/Selenium.html","/resource/website/","/share/work/learning-by-doing.html","/share/work/","/website/about-site/link.html","/website/about-site/","/website/about-site/website.html","/website/experience/author-information.html","/website/experience/portfolio.html","/website/experience/","/note/computer/git/git-procedure.html","/note/computer/network/process.html","/note/computer/network/TCP.html","/note/computer/network/UDP.html","/resource/website/utils/dazidazi.html","/resource/website/utils/free-clashnode.html","/resource/website/utils/","/resource/website/acknowledge/JavaGuide.html","/resource/website/acknowledge/","/404.html","/note/computer/git/","/note/computer/","/note/computer/network/","/category/","/category/english/","/category/%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/","/category/%E6%8C%87%E5%8D%97/","/category/%E8%B5%84%E6%BA%90/","/category/%E7%BB%8F%E9%AA%8C%E5%88%86%E4%BA%AB/","/category/%E7%BD%91%E7%AB%99%E7%9B%B8%E5%85%B3/","/category/git/","/category/computer/","/tag/","/tag/%E7%A6%81%E7%94%A8/","/tag/%E5%8A%A0%E5%AF%86/","/tag/%E5%B8%83%E5%B1%80/","/tag/markdown/","/tag/%E9%A1%B5%E9%9D%A2%E9%85%8D%E7%BD%AE/","/tag/%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/","/tag/%E5%B7%A5%E5%85%B7/","/tag/%E7%A7%AF%E7%B4%AF/","/tag/%E8%8B%B1%E8%AF%AD%E5%8F%A3%E8%AF%AD/","/tag/%E8%BD%AF%E4%BB%B6%E6%B5%8B%E8%AF%95/","/tag/%E6%95%99%E7%A8%8B/","/tag/%E5%8F%8B%E6%83%85%E9%93%BE%E6%8E%A5/","/tag/%E5%85%B3%E4%BA%8E%E6%9C%AC%E7%AB%99/","/tag/%E7%BD%91%E7%AB%99/","/article/","/star/","/timeline/"],Be="SLIMSEARCH_QUERY_HISTORY",E=M(Be,[]),be=()=>{const{queryHistoryCount:r}=k;return{enabled:r>0,queryHistories:E,addQueryHistory:u=>{E.value=Array.from(new Set([u,...E.value.slice(0,r-1)]))},removeQueryHistory:u=>{E.value=[...E.value.slice(0,u),...E.value.slice(u+1)]}}},S=r=>we[r.id]+("anchor"in r?`#${r.anchor}`:""),ke="SLIMSEARCH_RESULT_HISTORY",{resultHistoryCount:j}=k,g=M(ke,[]),fe=()=>({enabled:j>0,resultHistories:g,addResultHistory:i=>{{const u={link:S(i),display:i.display};"header"in i&&(u.header=i.header),g.value=[u,...g.value.slice(0,j-1)]}},removeResultHistory:i=>{g.value=[...g.value.slice(0,i),...g.value.slice(i+1)]}}),De=r=>{const{page:i,routeLocale:u}=de(),f=he(),l=R(0),A=b(()=>l.value>0),d=me([]);return ve(()=>{const{search:D,terminate:v}=ye(),w=Ee(y=>{const{resultsFilter:H=a=>a,querySplitter:p,suggestionsFilter:Q,...o}=f.value;y?(l.value+=1,D(y,u.value,o).then(a=>H(a,y,u.value,i.value)).then(a=>{l.value-=1,d.value=a}).catch(a=>{console.warn(a),l.value-=1,l.value||(d.value=[])})):d.value=[]},k.searchDelay-k.suggestDelay,{maxWait:5e3});pe([r,u],([y])=>w(y.join(" "))),ge(()=>{v()})}),{isSearching:A,results:d}};var xe=N({name:"SearchResult",props:{queries:{type:Array,required:!0},isFocusing:Boolean},emits:["close","updateQuery"],setup(r,{emit:i}){const u=V(),f=X(),l=Z(ee),{addQueryHistory:A,queryHistories:d,removeQueryHistory:D}=be(),{resultHistories:v,addResultHistory:w,removeResultHistory:y}=fe(),H=te(r,"queries"),{results:p,isSearching:Q}=De(H),o=se({isQuery:!0,index:0}),a=R(0),h=R(0),q=b(()=>d.value.length>0||v.value.length>0),x=b(()=>p.value.length>0),C=b(()=>p.value[a.value]||null),P=()=>{const{isQuery:t,index:s}=o;s===0?(o.isQuery=!t,o.index=t?v.value.length-1:d.value.length-1):o.index=s-1},U=()=>{const{isQuery:t,index:s}=o;s===(t?d.value.length-1:v.value.length-1)?(o.isQuery=!t,o.index=0):o.index=s+1},O=()=>{a.value=a.value>0?a.value-1:p.value.length-1,h.value=C.value.contents.length-1},_=()=>{a.value=a.value<p.value.length-1?a.value+1:0,h.value=0},z=()=>{h.value<C.value.contents.length-1?h.value+=1:_()},Y=()=>{h.value>0?h.value-=1:O()},F=t=>t.map(s=>Ae(s)?s:e(s[0],s[1])),G=t=>{if(t.type==="customField"){const s=ce[t.index]||"$content",[m,c=""]=ne(s)?s[f.value].split("$content"):s.split("$content");return t.display.map(n=>e("div",F([m,...n,c])))}return t.display.map(s=>e("div",F(s)))},B=()=>{a.value=0,h.value=0,i("updateQuery",""),i("close")},J=()=>e("div",{class:"slimsearch-records"},e("div",{class:"slimsearch-record"},[e("div",{class:"slimsearch-record-title"},l.value.queryHistory),e("ul",{class:"slimsearch-record-contents",role:"listbox"},d.value.map((t,s)=>{const m=o.isQuery&&o.index===s;return e("li",{class:["slimsearch-record-matches",{active:m}],role:"option","aria-selected":m,onClick:()=>{i("updateQuery",t)}},e("div",[e(T,{class:"slimsearch-record-type"}),e("div",{class:"slimsearch-record-content"},t),e("button",{type:"button",class:"slimsearch-remove-icon",title:l.value.remove,"aria-label":l.value.remove,innerHTML:I,onClick:c=>{c.preventDefault(),c.stopPropagation(),D(s)}})]))}))])),W=()=>e("ul",{class:"slimsearch-records"},e("li",{class:"slimsearch-record"},[e("div",{class:"slimsearch-record-title"},l.value.resultHistory),e("ul",{class:"slimsearch-record-contents",role:"listbox"},v.value.map((t,s)=>{const m=!o.isQuery&&o.index===s;return e("li",{class:["slimsearch-record-matches",{active:m}],role:"option","aria-selected":m},e($,{to:t.link,onClick:()=>{B()}},()=>[e(T,{class:"slimsearch-record-type"}),e("div",{class:"slimsearch-record-content"},[t.header?e("div",{class:"slimsearch-record-content-header"},t.header):null,e("div",t.display.map(c=>F(c)).flat())]),e("button",{type:"button",class:"slimsearch-remove-icon",title:l.value.remove,"aria-label":l.value.remove,innerHTML:I,onClick:c=>{c.preventDefault(),c.stopPropagation(),y(s)}})]))}))]));return ae("keydown",t=>{if(r.isFocusing){if(x.value){if(t.key==="ArrowUp")Y();else if(t.key==="ArrowDown")z();else if(t.key==="Enter"){const s=C.value.contents[h.value];A(r.queries.join(" ")),w(s),u.push(S(s)),B()}}else if(t.key==="ArrowUp")P();else if(t.key==="ArrowDown")U();else if(t.key==="Enter"){const{index:s}=o;o.isQuery?(t.preventDefault(),i("updateQuery",d.value[s])):(u.push(v.value[s].link),B())}}}),re([a,h],()=>{document.querySelector(".slimsearch-record.active .slimsearch-record-matches.active")?.scrollIntoView(!1)},{flush:"post"}),()=>e("div",{id:"slimsearch-results",class:["slimsearch-result-wrapper",{empty:r.queries.length?!x.value:!q.value}]},r.queries.length?Q.value?e(le,{hint:l.value.searching}):x.value?e("div",{class:"slimsearch-records",role:"listbox","aria-labeledby":"slimsearch-label"},p.value.map(({title:t,contents:s},m)=>{const c=a.value===m;return e("div",{class:["slimsearch-record",{active:c}],role:"group","aria-selected":c},[e("div",{class:"slimsearch-record-title"},t||l.value.defaultTitle),e("ul",{class:"slimsearch-record-contents"},s.map((n,K)=>{const L=c&&h.value===K;return e("li",{class:["slimsearch-record-matches",{active:L}],role:"option","aria-selected":L},e($,{to:S(n),onClick:()=>{A(r.queries.join(" ")),w(n),B()}},()=>[n.type==="text"?null:e(n.type==="title"?oe:n.type==="heading"?ie:ue,{class:"slimsearch-record-type"}),e("div",{class:"slimsearch-record-content"},[n.type==="text"&&n.header?e("div",{class:"slimsearch-record-content-header"},n.header):null,e("div",G(n))])]))}))])})):l.value.emptyResult:q.value?[J(),W()]:l.value.emptyHistory)}});export{xe as default};
